#!/usr/bin/env ruby
# List zettel with wiki links to the given slug

require 'clamp'
require 'open3'
require_relative 'zettel'

Clamp do
  parameter "SLUG", "slug to find links to", :attribute_name => :slug
  option ["-p", "--pprint"], :flag, "pretty print", :attribute_name => :pretty_print

  def execute
    format_string = "%-10s  %s"

    if pretty_print?
      puts format_string % ["Slug", "Title"]
      puts format_string % ["----", "-----"]
    end

    zettel = Zettel.new_from_link(slug)
    zettel.links_to.each do |z|
      if pretty_print?
        puts format_string % [z.slug, z.metadata[:title]]
      else
        puts z.link
      end
    end
  end
end
